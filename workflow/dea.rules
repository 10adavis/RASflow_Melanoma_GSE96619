configfile: "../configs/config_batch5_TimeResp_PCLS.yaml"

samples = ["C12-1", "C12-2", "C12-3", "C12-4", "C12-5", "C24-1", "C24-2", "C24-3", "C24-4", "C24-5", "C48-1", "C48-2", "C48-3", "C48-4", "C48-5", "D1", "D2", "D3", "D4", "D5", "E12-1", "E12-2", "E12-3", "E12-4", "E12-5", "E24-1", "E24-2", "E24-3", "E24-4", "E24-5", "E48-1", "E48-2", "E48-3", "E48-4", "E48-5", "Mx-1", "Mx-2", "Mx-3", "Mx-4", "Mx-5", "OP1", "OP2", "OP3", "OP4", "OP5"]
groups = ["C12", "C24", "C48", "E12", "E24", "E48", "D", "Mx", "OP"]
chemicals = ["E12", "E24", "E48", "D", "Mx", "OP"]

rule all:
    input:
        edger_C12_E12_dea = config["OUTPUTPATH"] + "DEA/edger/dea_C12_E12.csv",
        edger_C12_E12_deg = config["OUTPUTPATH"] + "DEA/edger/deg_C12_E12.csv"

# The rule below is not flexibal, needs to change manually, the used script combine_batch5_TimeResp_PCLS.sh is only suitable for batch5_TimeResp_PCLS
rule combineSamples:
    input:
        geneCount = expand(config["OUTPUTPATH"] + "countFile/{sample}.countmerged.idx", sample = samples)
    output:
        expand(config["OUTPUTPATH"] + "countFile/{group}.countmerged.idx", group = groups)
    params:
        path = config["OUTPUTPATH"] + "countFile"
    shell:
        "cp ../scripts/combine_batch5_TimeResp_PCLS.sh {params.path} && cd {params.path} && bash combine_batch5_TimeResp_PCLS.sh && rm combine_batch5_TimeResp_PCLS.sh"

rule prepareDEA:
    input:
        C12 = config["OUTPUTPATH"] + "countFile/C12.countmerged.idx",
        C24 = config["OUTPUTPATH"] + "countFile/C24.countmerged.idx",
        C48 = config["OUTPUTPATH"] + "countFile/C48.countmerged.idx",
        E12 = config["OUTPUTPATH"] + "countFile/E12.countmerged.idx",
        E24 = config["OUTPUTPATH"] + "countFile/E24.countmerged.idx",
        E48 = config["OUTPUTPATH"] + "countFile/E48.countmerged.idx",
        D = config["OUTPUTPATH"] + "countFile/D.countmerged.idx",
        Mx = config["OUTPUTPATH"] + "countFile/Mx.countmerged.idx",
        OP = config["OUTPUTPATH"] + "countFile/OP.countmerged.idx"
    output:
        C12_E12 = config["OUTPUTPATH"] + "DEA/C12_E12",
        C24_E24 = config["OUTPUTPATH"] + "DEA/C24_E24",
        C48_E48 = config["OUTPUTPATH"] + "DEA/C48_E48",
        C12_D = config["OUTPUTPATH"] + "DEA/C12_D",
        C12_Mx = config["OUTPUTPATH"] + "DEA/C12_Mx",
        C12_OP = config["OUTPUTPATH"] + "DEA/C12_OP"
    shell:
        "paste {input.C12} <(cut -f2- {input.E12}) >> {output.C12_E12} && "
        "paste {input.C24} <(cut -f2- {input.E24}) >> {output.C24_E24} && "
        "paste {input.C48} <(cut -f2- {input.E48}) >> {output.C48_E48} && "
        "paste {input.C12} <(cut -f2- {input.D}) >> {output.C12_D} && "
        "paste {input.C12} <(cut -f2- {input.Mx}) >> {output.C12_Mx} && "
        "paste {input.C12} <(cut -f2- {input.OP}) >> {output.C12_OP}"
rule DEA:
    input:
        C12_E12 = config["OUTPUTPATH"] + "DEA/C12_E12",
        C24_E24 = config["OUTPUTPATH"] + "DEA/C24_E24",
        C48_E48 = config["OUTPUTPATH"] + "DEA/C48_E48",
        C12_D = config["OUTPUTPATH"] + "DEA/C12_D",
        C12_Mx = config["OUTPUTPATH"] + "DEA/C12_Mx",
        C12_OP = config["OUTPUTPATH"] + "DEA/C12_OP"
    output:
        C12_E12_norm = config["OUTPUTPATH"] + "DEA/C12_E12_norm.csv",
        C24_E24_norm = config["OUTPUTPATH"] + "DEA/C24_E24_norm.csv",
        C48_E48_norm = config["OUTPUTPATH"] + "DEA/C48_E48_norm.csv",
        C12_D_norm = config["OUTPUTPATH"] + "DEA/C12_D_norm.csv",
        C12_Mx_norm = config["OUTPUTPATH"] + "DEA/C12_Mx_norm.csv",
        C12_OP_norm = config["OUTPUTPATH"] + "DEA/C12_OP_norm.csv",
        edger_C12_E12_dea = config["OUTPUTPATH"] + "DEA/edger/dea_C12_E12.csv",
        edger_C24_E24_dea = config["OUTPUTPATH"] + "DEA/edger/dea_C24_E24.csv",
        edger_C48_E48_dea = config["OUTPUTPATH"] + "DEA/edger/dea_C48_E48.csv",
        edger_C12_D_dea = config["OUTPUTPATH"] + "DEA/edger/dea_C12_D.csv",
        edger_C12_Mx_dea = config["OUTPUTPATH"] + "DEA/edger/dea_C12_Mx.csv",
        edger_C12_OP_dea = config["OUTPUTPATH"] + "DEA/edger/dea_C12_OP.csv",
        edger_C12_E12_deg = config["OUTPUTPATH"] + "DEA/edger/deg_C12_E12.csv",
        edger_C24_E24_deg = config["OUTPUTPATH"] + "DEA/edger/deg_C24_E24.csv",
        edger_C48_E48_deg = config["OUTPUTPATH"] + "DEA/edger/deg_C48_E48.csv",
        edger_C12_D_deg = config["OUTPUTPATH"] + "DEA/edger/deg_C12_D.csv",
        edger_C12_Mx_deg = config["OUTPUTPATH"] + "DEA/edger/deg_C12_Mx.csv",
        edger_C12_OP_deg = config["OUTPUTPATH"] + "DEA/edger/deg_C12_OP.csv"
    shell:
        "Rscript ../scripts/dea_edger_pair.R {input.C12_E12} {output.C12_E12_norm} {output.edger_C12_E12_dea} {output.edger_C12_E12_deg} && "
        "Rscript ../scripts/dea_edger_pair.R {input.C24_E24} {output.C24_E24_norm} {output.edger_C24_E24_dea} {output.edger_C24_E24_deg} && "
        "Rscript ../scripts/dea_edger_pair.R {input.C48_E48} {output.C48_E48_norm} {output.edger_C48_E48_dea} {output.edger_C48_E48_deg} && "
        "Rscript ../scripts/dea_edger_pair.R {input.C12_D} {output.C12_D_norm} {output.edger_C12_D_dea} {output.edger_C12_D_deg} && "
        "Rscript ../scripts/dea_edger_pair.R {input.C12_Mx} {output.C12_Mx_norm} {output.edger_C12_Mx_dea} {output.edger_C12_Mx_deg} && "
        "Rscript ../scripts/dea_edger_pair.R {input.C12_OP} {output.C12_OP_norm} {output.edger_C12_OP_dea} {output.edger_C12_OP_deg}"


